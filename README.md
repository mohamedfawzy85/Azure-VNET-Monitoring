# Monitoring Solution for Azure VNet Utilization

## Overview

This solution is designed to monitor the utilization of Virtual Networks (VNets) in your Azure environment. It collects data about each subnet within your VNets, including the total number of IP addresses, used IP addresses, and available IP addresses. Additionally, it evaluates a specific condition: whether the used IP count in a subnet is greater than or equal to 80% of the total IP count for that subnet. If this condition is met, it assigns a value of 1; otherwise, it assigns a value of 0. The reason for that is to create azure alert query this value, if the value is 1 it will create fire alert.
Azure workbook also is used to visualize the data collected by the azure function.

## Overview

This comprehensive solution is designed to monitor and manage the utilization of Virtual Networks (VNets) in your Azure environment. It consists of four key components, each playing a crucial role in ensuring the efficiency and reliability of your network resources. 

### Azure Function

The Azure Function serves as the core of this solution. It periodically collects detailed data about each subnet within your VNets, capturing essential metrics such as the total number of IP addresses, used IP addresses, and available IP addresses. However, its significance goes beyond data collection. It evaluates a critical condition: whether the used IP count in a subnet exceeds 80% of the total IP count for that subnet. When this condition is met, the function assigns a value of 1, indicating a potential issue with subnet utilization. Conversely, if the condition is not met, it assigns a value of 0. This value serves as a trigger for the Azure Alert component.

### Log Analytics (Custom Table)

The data collected by the Azure Function is securely stored in a Log Analytics custom table. This table acts as a centralized repository for your VNet utilization data, providing easy access, querying, and analysis capabilities. The data is structured in a JSON format, facilitating efficient storage and retrieval. This component serves as the foundation for both visualization and alerting.

### Azure Workbook

Azure Workbook complements this solution by offering powerful visualization capabilities. It allows you to create insightful dashboards and reports to gain a holistic view of your VNet utilization. By leveraging the data stored in the Log Analytics custom table, you can monitor trends, identify anomalies, and make informed decisions to optimize your Azure network resources. The Workbook helps transform raw data into actionable insights.

### Azure Alert

The Azure Alert component plays a vital role in ensuring proactive network management. It continuously monitors the condition values generated by the Azure Function. When a condition value of 1 is detected, signifying that the utilization of a subnet has exceeded 80%, the alert is triggered. This immediate notification enables you to take timely corrective actions, preventing potential network issues and service disruptions.

This integrated solution empowers you to maintain the health and efficiency of your Azure VNets. It combines data collection, storage, visualization, and alerting into a cohesive framework, providing you with the tools needed to proactively manage and optimize your network resources.


## Purpose

The primary purpose of this solution is to provide insights into VNet utilization. By analyzing the utilization of subnets within your VNets, you can proactively manage and allocate resources, ensuring that your Azure environment operates efficiently.

## How it Works

The solution operates in a straightforward and automated manner to monitor VNet utilization. Here's a step-by-step explanation of how it works:
Azure Function Execution: The Azure Function, scheduled to run at defined intervals, begins its execution.

Data Collection: The Function collects essential data about each subnet within your VNets. This data includes the total number of IP addresses, used IP addresses, and available IP addresses.

Evaluation of Condition: For each subnet, the Function evaluates whether the used IP count exceeds 80% of the total IP count. If the condition is met, a value of 1 is assigned; otherwise, a value of 0 is assigned.

Data Storage: The collected data, along with the condition values, is securely stored in a Log Analytics custom table in JSON format.

Visualization: Azure Workbook is used to visualize the data from the custom table. It enables you to create customized dashboards and reports, allowing you to monitor VNet utilization trends effectively.

Alerting: Azure Alert continuously monitors the condition values generated by the Function. If a condition value of 1 is detected, signifying high subnet utilization, the alert triggers an immediate notification.

This automated process ensures that you stay informed about your VNet utilization in real-time, enabling you to take proactive measures when necessary.

## Prerequisites

- Azure subscription.
- Azure Function App with appropriate permissions.
- Log Analytics workspace for data storage and analysis.

## Configuration

Before using this function, you need to configure the following settings:

- Azure Function environment variables.
- Log Analytics workspace settings.

## Usage

This function is scheduled to run at predefined intervals and requires minimal user interaction. Ensure that it is correctly configured and deployed to your Azure environment.

## Outputs

The function generates data that includes subnet information and condition values (1 or 0), which can be analyzed in Log Analytics to monitor VNet utilization.

## License

[Specify the license for your code, e.g., MIT License.]

## Author

[Your Name or Organization Name]


