# Azure VNet Utilization Monitoring Solution README

## Overview

This solution is designed to monitor the utilization of Virtual Networks (VNets) in your Azure environment. It collects data about each subnet within your VNets, including the total number of IP addresses, used IP addresses, and available IP addresses. Additionally, it evaluates a specific condition: whether the used IP count in a subnet is greater than or equal to 80% of the total IP count for that subnet. If this condition is met, it assigns a value of 1; otherwise, it assigns a value of 0. The reason for that is to create azure alert query this value, if the value is 1 it will create fire alert.
Azure workbook also is used to visualize the data collected by the azure function.

## Components

This solution comprises four key components:

1. **Azure Function**: The Azure Function is responsible for executing the monitoring script. It collects data about your VNets, evaluates subnet utilization, and stores the results.

2. **Log Analytics - Custom Table**: Azure Log Analytics hosts a custom table where the collected VNet utilization data is securely stored in JSON format. You can query this table to retrieve historical data and perform analysis.

3. **Azure Workbook**: Azure Workbook is a powerful tool for visualizing data from the custom table. You can create customized dashboards and reports to monitor VNet utilization trends effectively.

4. **Azure Alert**: Azure Alert continuously monitors the condition values generated by the Azure Function. If a condition value of 1 is detected, signifying high subnet utilization, the alert triggers an immediate notification.

## How It Works

This solution is implemented using an Azure Function written in PowerShell. Here's how it works:

1. The Azure Function is triggered at defined intervals (e.g., every 5 minutes) using a TimerTrigger.

2. The function collects data about your VNets, including subnet details such as address space, total IP count, used IP count, and available IP count.

3. It evaluates the utilization condition for each subnet. If the used IP count is greater than or equal to 80% of the total IP count, it assigns a value of 1; otherwise, it assigns a value of 0.

4. The results, including the condition values, are formatted as JSON and stored securely in a custom table within Azure Log Analytics.

5. You can use Azure Workbook to create customized visualizations and dashboards to monitor your VNet utilization trends over time.

6. Azure Alert continuously monitors the condition values. If it detects a condition value of 1, indicating high subnet utilization, it triggers an alert for immediate notification.

## Prerequisites

Before implementing this solution, make sure you have the following prerequisites in place:

- An Azure subscription with sufficient permissions to create Azure Function, Log Analytics, Workbook, and Alert resources.

- PowerShell scripting knowledge to understand and modify the Azure Function code as needed.

## Configuration

1. Create an Azure Function using the provided PowerShell script.

2. Configure the TimerTrigger to run the function at your desired intervals.

3. Set up Azure Log Analytics and create a custom table to store the VNet utilization data.

4. Configure Azure Workbook to visualize the data from the custom table.

5. Create an Azure Alert to monitor the condition values generated by the function.

## Outputs

The primary outputs of this solution include:

- VNet utilization data securely stored in a custom table within Azure Log Analytics.

- Visualizations and dashboards created using Azure Workbook to monitor VNet utilization trends.

- Azure Alerts triggered when high subnet utilization (condition value of 1) is detected.

Feel free to customize and extend this solution to meet your specific monitoring and alerting needs.
